# 8.5 ファイル入出力の基本
標準入出力ストリームと同じような方法で、ファイルの入手力を行えます。
どのファイルで入出力するかはプログラムが始まらないとわからないので、標準入出力ストリームのようにあらかじめオブジェクトが用意されているわけではありません。

そのため、ユーザーが**ファイルストリームオブジェクト**を作成し、対象となるファイルを指定して開く操作が必要になります。
またファイル入出力の操作が終わったら閉じる操作も必要ですが、クローズはデストラクターに任せることも可能です。

## 8.5.1 ファイルストリーム
ファイルストリームはstd::basic_iostream テンプレートクラスなどからさらに派生したstd::basic_fstreamテンプレートクラスを使います。

標準入出力オブジェクトでは入出力両方というものはありませんでしたが、ファイル入出力では1つのファイルで入力と出力を行う場合があり、そういった際に使うことができるクラスも用意されています。
またstd::fstreamはstd::ifstreamからもstd::ofstreamからも派生しているので、それらの代わりに関数に渡すことも可能です。

ファイルを開くにはコンストラクターにファイル名を渡すか、デフォルトコンストラクターでオブジェクトを作成した後、open()メンバー関数を使います。
ファイルを閉じるにはファイルストリームオブジェクトのデストラクターを使うか、close()メンバー関数を使います。

```C++
// コンストラクターとopen()メンバー関数・close()メンバー関数
fstream(const std::string& filename, std::ios::openmode mode = default-openmode);

void open(const std::string& filename, std::ios::openmode mode = default-openmode);


void close();
```

modeのデフォルト引数はストリームによって異なる。

標準ライブラリの入出力では実際に入出力されるデバイスは抽象化されており、一貫したインターフェースが提供されているので、実際に使用する際にはどんなデバイスに接続されているかを気にする必要はありません。

## 8.5.2 ファイルオープンのモードフラグ
ファイルをオープンする際、どのような用途・状態でオープンするかを表すモードを指定するためにstd::ios::openmodeというフラグを渡すことができます。

| モードフラグ | 意味 |
| --- | --- | 
| std::ios::in | 入力可能なようにオープンする |
| std::ios::out | 出力可能なようにオープンする |
| std::ios::app | 出力がファイルの末尾にシークする |
| std::ios::trunc | すでにファイルが持っているデータを破壊してからオープンする |
| std::ios::binary | バイナリモードでオープンする |

これらのモードはopen()メンバー関数の第二引数か、コンストラクターの第二引数で渡すことができ、またビットor演算子(|) を使って複数組み合わせることもできます。
なお、もし途中でモードを変えたくなった際には、一度ファイルをクローズしてから再度オープンする必要があることに注意してください。

フラグの指定を省略した場合も、何かしらのフラグを与えた場合でも、std::ifstreamとstd::ofstreamは暗黙的にそれぞれinとoutを設定します。
しかし、std::fstreamは省略した際にはinとoutの両方が設定されますが、何かフラグを与えた場合にはinもoutも暗黙的には指定されません。ミスを防ぐためにも、何か他のフラグを指定する場合にはinとoutを適切に指定するようにしておくのが良いでしょう。

std::ios::app と std::ios::ateは、一見似たような機能を提供するのですがそれぞれの動作は少し違います。
std::ios::ateはファイルをオープンしたそのときにだけ、ファイルの末尾にシークするので、再度シークすれば好きな位置から読み書きできます。
一方、std::ios::appはオープンした直後は先頭を指し示したままですが、何か出力する直前に必ずファイルの末尾にシークしてから出力します。
何かのログファイルのように、常に末尾に追加していく方が良いファイルは、std::ios::appでオープンすることでファイルに元々あったデータを破壊せずに出力できます。

std::ios::binaryは改行の動作を変更するフラグです。改行を示す文字はOSごとに少しずつ違うため、ユーザーがその違いを気にする必要がないよう、入出力時に改行文字を調整するかしないかを指定できます。

## 8.5.3 ファイルオープンの失敗
ファイルをオープンしようとした際に、「そもそも失敗してしまう」という場合があります。たとえオープンに失敗してもデフォルトではそのまま処理が続行されてしまうので、実際にはオープンできたかどうかを確かめるひつお用があります。
最も楽な方法としてはis_open()メンバー関数があります。is_open()メンバー関数は、ファイルストリームが何かのファイルをオープンしている場合にtrueを返すだけの簡単な関数です。

```C++
bool is_open() const;
```

## 8.5.4 ファイルの終端
ファイルには必ず終わりがあります。ファイルに出力していくときにはファイルの終端(**EOF**)は必要に応じて伸びていくので気にする必要はありませんが、ファイルから入力するときには必ずファイルの種たんについて考えなければなりません。
現在の入力ストリームがファイルの終端にあるかどうかはeof()メンバー関数を使うことで調べることができます。

```C++
bool eof() const;
```
